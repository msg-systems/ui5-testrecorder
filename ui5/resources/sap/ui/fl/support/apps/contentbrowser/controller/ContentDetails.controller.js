/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/m/Text","sap/m/Button","sap/ui/fl/support/apps/contentbrowser/lrepConnector/LRepConnector","sap/ui/fl/support/apps/contentbrowser/utils/DataUtils"],function(C,D,T,B,L,a){"use strict";return C.extend("sap.ui.fl.support.apps.contentbrowser.controller.ContentDetails",{oSelectedContentModel:undefined,oDataUtils:a,onInit:function(){this._initAndBindSelectedContentModel();var r=sap.ui.core.UIComponent.getRouterFor(this);r.getRoute("ContentDetails").attachMatched(this._onRouteMatched,this);r.getRoute("ContentDetailsFlip").attachMatched(this._onRouteMatched,this);},_initAndBindSelectedContentModel:function(){this.oSelectedContentModel=new sap.ui.model.json.JSONModel();this.getView().setModel(this.oSelectedContentModel,"selectedContent");},_onRouteMatched:function(r){var t=this;var R=r.getParameter("arguments");var m={};m.layer=R.layer;m.namespace=decodeURIComponent(R.namespace);m.fileName=R.fileName;m.fileType=R.fileType;if(m.namespace[m.namespace.length-1]!=="/"){m.namespace+="/";}var c=m.namespace+m.fileName+"."+m.fileType;var p=t.getView().getContent()[0];p.setBusy(true);return L.getContent(m.layer,c,null,null,true).then(t._onContentReceived.bind(t,m,p,c),function(){p.setBusy(false);});},_onContentReceived:function(m,p,c,d){var t=this;m.data=a.formatData(d,m.fileType);if(m.fileType){return L.getContent(m.layer,c,true).then(t._onContentMetadataReceived.bind(t,m,p),function(){p.setBusy(false);});}else{return Promise().resolve();}},_onContentMetadataReceived:function(m,p,M){m.metadata=M;this.oSelectedContentModel.setData(m);var c=sap.ui.getCore();var i=this.getView().createId("contentDetailsIconTabBar");var I=c.getElementById(i);if(I){var f=I.getItems()[0];if(I.getSelectedKey()!==f.getId()){I.setSelectedItem(f);}}p.setBusy(false);},onEditClicked:function(){var s=this.getView().getModel("selectedContent");var c=s.getData();var r=sap.ui.core.UIComponent.getRouterFor(this);r.navTo("ContentDetailsEdit",{"layer":c.layer,"namespace":encodeURIComponent(c.namespace),"fileName":c.fileName,"fileType":c.fileType});},onDeleteClicked:function(){var t=this;var d=new D({title:"{i18n>confirmDeletionTitle}",type:"Message",content:new T({text:"{i18n>questionFileDeletion}"}),beginButton:new B({text:"{i18n>confirm}",type:sap.m.ButtonType.Reject,press:function(){t._deleteFile();d.close();}}),endButton:new B({text:"{i18n>cancel}",press:function(){d.close();}}),afterClose:function(){d.destroy();}});this.getView().addDependent(d);d.open();},_deleteFile:function(){var s=this.getView().getModel("selectedContent");var c=s.getData();var S=c.layer;var b="";c.metadata.some(function(m){if(m.name==="layer"){b=m.value;return true;}});var n=c.namespace;var f=c.fileName;var F=c.fileType;var r=sap.ui.core.UIComponent.getRouterFor(this);return L.deleteFile(b,n,f,F).then(function(){r.navTo("LayerContentMaster",{"layer":S,"namespace":encodeURIComponent(n)});});}});});
