/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/base/strings/capitalize"],function(q,L,c){"use strict";var C={};C._aChangeHandlerSettings=[];["addODataField","addODataFieldWithLabel"].forEach(function(s){["2.0","1.0"].forEach(function(v){C._aChangeHandlerSettings.push({key:{"scenario":s,"oDataServiceVersion":v},content:{"requiredLibraries":{"sap.ui.comp":{"minVersion":"1.48","lazy":false}}},scenarioInitialized:false});});});C.addChangeHandlerSettings=function(k,s){var n;if(!(k&&s)){throw new Error('New entry in ChangeHandlerMediator requires a key and settings');}n={key:k,content:s,scenarioInitialized:false};var e=this.getChangeHandlerSettings(k,true);var i=this._aChangeHandlerSettings.indexOf(e);if(i>-1){Object.assign(this._aChangeHandlerSettings[i].content,n.content);this._aChangeHandlerSettings[i].scenarioInitialized=false;}else{this._aChangeHandlerSettings.push(n);this._createChangeHandlerSettingsGetter(n);}};C.getChangeHandlerSettings=function(k,s){var K=Object.keys(k);var f;if(K.length>0){f=this._aChangeHandlerSettings.filter(function(e,i){var E=Object.keys(e.key);if(E.length===K.length){var m=K.filter(function(a){if(e.key[a]===k[a]){return true;}});if(m.length===K.length){return true;}}})[0];if(!s&&f&&!f.scenarioInitialized){f.scenarioInitialized=this._initializeScenario(f);}}if(s||(f&&f.scenarioInitialized)){return f;}};C._initializeScenario=function(f){var l;if(f.content.requiredLibraries){try{var a=Object.keys(f.content.requiredLibraries);a.forEach(function(s){l=s;sap.ui.getCore().loadLibrary(s);});var i=this._aChangeHandlerSettings.indexOf(f);this._aChangeHandlerSettings[i].scenarioInitialized=true;return true;}catch(e){L.warning("Required library not available: "+l+" - "+f.key.scenario+" could not be initialized");return false;}}};C._createChangeHandlerSettingsGetter=function(m){var g='get'+c(m.key.scenario)+'Settings';if(!C[g]){C[g]=function(o){var O;var f;try{O=o.getModel().getMetaModel().getProperty("/dataServices/dataServiceVersion");}catch(e){L.warning("Data service version could not be retrieved");}f=this.getChangeHandlerSettings({"scenario":m.key.scenario,"oDataServiceVersion":O});if(f&&f.content&&f.content.createFunction){return f;}};}};C._aChangeHandlerSettings.forEach(function(m){C._createChangeHandlerSettingsGetter(m);});return C;},true);
