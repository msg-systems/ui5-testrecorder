/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/_OpaLogger","sap/ui/test/_ParameterValidator","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/autowaiter/_autoWaiterLogCollector","sap/ui/thirdparty/jquery"],function(_,a,b,c,q){"use strict";var l=_.getLogger("sap.ui.test.autowaiter._autoWaiterAsync");var C=new a({errorPrefix:"sap.ui.test.autowaiter._autoWaiterAsync#extendConfig"});var w;var L;var d={interval:400,timeout:15000};function e(o){v(o);q.extend(d,o);b.extendConfig(d);}function f(g){if(w){n({error:"waitAsync is already running and cannot be called again at this moment"});return;}var p=Date.now();w=true;l.debug("Start polling to check for pending asynchronous work");c.start();h();function h(){var i=(Date.now()-p);if(i<=d.timeout){setTimeout(function(){if(b.hasToWait()){L=c.getAndClearLog();h();}else{n({log:"Polling finished successfully. There is no more pending asynchronous work for the moment"});w=false;}},d.interval);}else{n({error:"Polling stopped because the timeout of "+d.timeout+" milliseconds has been reached but there is still pending asynchronous work.\n"+"This is the last log of pending work:\n"+L});w=false;}}function n(r){if(g){g(r.error);}l.debug(r.error||r.log);c.stop();}}function v(o){C.validate({inputToValidate:o,validationInfo:{interval:"numeric",timeout:"numeric"}});if(o.timeout<=0||o.interval<=0){throw new Error("Invalid polling config: Timeout and interval should be greater than 0");}}return{extendConfig:e,waitAsync:f};},true);
