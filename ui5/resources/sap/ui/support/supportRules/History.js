/**
* UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/support/library","sap/ui/support/supportRules/IssueManager","sap/ui/support/supportRules/RuleSetLoader","sap/ui/support/supportRules/report/StringHistoryFormatter","sap/ui/support/supportRules/report/AbapHistoryFormatter"],function(l,I,R,S,A){"use strict";var _=[];var a=function(r,f){return{loadedLibraries:{},analysisInfo:{duration:r.analysisDuration,date:r.date,executionScope:r.scope.executionScope},applicationInfo:r.application,technicalInfo:r.technical,totalIssuesCount:0,issues:r.onlyIssues};};var b=function(t,L,r){t.loadedLibraries[L]={};var o=t.loadedLibraries[L];o["rules"]={};o["issueCount"]=r.rules[L].issueCount;o["allRulesSelected"]=true;t.totalIssuesCount+=r.rules[L].issueCount;};var c=function(t,L,r,o){var e=o.rules[L][r];t.loadedLibraries[L]["rules"][r]={id:r,library:L,name:e.title,selected:e.selected,issuesCount:e.issueCount,issues:d(o,L,r),resolution:e.resolution,minVersion:e.minversion,categories:e.categories,audiences:e.audiences,description:e.description};if(e.selected===false){t.loadedLibraries[L]["allRulesSelected"]=false;}};var d=function(r,L,s){var i=[];if(r.issues[L]&&r.issues[L][s]){r.issues[L][s].forEach(function(o){var m={"context":o.context,"details":o.details,"name":o.name,"severity":o.severity};i.push(m);});}return i;};var H={getRuns:function(){return _.slice();},saveAnalysis:function(C){var i=I.groupIssues(I.getIssuesModel()),e=I.getIssues(),r=R.getRuleSets(),s=C._oSelectedRulesIds;_.push({date:new Date().toUTCString(),issues:i,onlyIssues:e,application:C._oDataCollector.getAppInfo(),technical:C._oDataCollector.getTechInfoJSON(),rules:I.getRulesViewModel(r,s,i),scope:{executionScope:{type:C._oExecutionScope._getType(),selectors:C._oExecutionScope._getContext().parentId||C._oExecutionScope._getContext().components}},analysisDuration:C._oAnalyzer.getElapsedTimeString()});},clearHistory:function(){_=[];},getHistory:function(){var o=[];_.forEach(function(r){var t=a(r);for(var L in r.rules){b(t,L,r);for(var s in r.rules[L]){c(t,L,s,r);}}o.push(t);});return o;},getFormattedHistory:function(f){var F,h=this.getHistory();switch(f){case l.HistoryFormats.Abap:F=A.format(h);break;default:F=S.format(h);}return F;}};return H;},true);
