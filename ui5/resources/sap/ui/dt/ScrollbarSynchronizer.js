/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/base/ManagedObject','sap/ui/dt/DOMUtil',"sap/ui/thirdparty/jquery"],function(M,D,q){"use strict";var S=M.extend("sap.ui.dt.ScrollbarSynchronizer",{metadata:{library:"sap.ui.dt",properties:{"scrollTop":{type:"float"},"scrollLeft":{type:"float"},"targets":{type:"any[]",defaultValue:[]}},events:{synced:{}}},_bSyncing:false,constructor:function(){this._scrollEventHandler=this._scrollEventHandler.bind(this);M.apply(this,arguments);}});S.prototype.getTargets=function(){return this.getProperty('targets').slice(0);};S.prototype.setTargets=function(t){var T=Array.isArray(t)?t:[t];this.getTargets().forEach(this.removeTarget.bind(this));this.addTarget.apply(this,T);};S.prototype.removeTarget=function(d){this._detachScrollEvent(d);this.setProperty('targets',this.getTargets().filter(function(t){return t!==d;}));};S.prototype.addTarget=function(){var t=Array.prototype.slice.call(arguments);if(!t.length){return;}this._removeDeadNodes();t.forEach(this._attachScrollEvent,this);var n=this.getTargets().concat(t);this.setProperty('targets',n);this.sync(n[0]);};S.prototype.hasTarget=function(d){return this.getTargets().indexOf(d)>-1;};S.prototype._removeDeadNodes=function(){this.getTargets().forEach(function(d){if(!document.body.contains(d)){this.removeTarget(d);}},this);};S.prototype._attachScrollEvent=function(d){q(d).on("scroll",this._scrollEventHandler);};S.prototype._detachScrollEvent=function(d){q(d).off("scroll",this._scrollEventHandler);};S.prototype._scrollEventHandler=function(e){this.sync(e.target);};S.prototype.sync=function(s,f){if(f||this.getScrollTop()!==s.scrollTop||this.getScrollLeft()!==s.scrollLeft){this.setScrollTop(s.scrollTop);this.setScrollLeft(s.scrollLeft);if(!this._bSyncing){this._bSyncing=true;this.animationFrame=window.requestAnimationFrame(function(){this.getTargets().filter(function(d){return s!==d;}).forEach(function(d){D.syncScroll(s,d);});this.fireSynced();this._bSyncing=false;}.bind(this));}}};S.prototype.destroy=function(){this.getTargets().forEach(function(d){this.removeTarget(d);},this);M.prototype.destroy.apply(this,arguments);};S.prototype.isSyncing=function(){return this._bSyncing;};return S;},true);
