/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/strings/escapeRegExp","jquery.sap.script"],function(e,q){"use strict";var a={"POST":true,"PUT":true,"PATCH":true,"DELETE":true},b,r=/\$\d+/,c=/(\S*?)=(?:"(.+)"|(\S+))/;function g(C){var B=d(C,"boundary"),m=C.trim().indexOf("multipart/mixed");if(m!==0||!B){throw new Error('Invalid $batch response header "Content-Type": '+C);}B=e(B);return new RegExp('--'+B+'(?:[ \t]*\r\n|--)');}function d(H,p){var P,i=H.split(";"),m;p=p.toLowerCase();for(P=1;P<i.length;P++){m=c.exec(i[P]);if(m[1].toLowerCase()===p){return m[2]||m[3];}}}function f(m){var C=j(m,"content-type");return C.indexOf("multipart/mixed;")===0?C:undefined;}function h(m){var C=j(m,"content-id"),R;if(!C){throw new Error("Content-ID MIME header missing for the change set response.");}R=parseInt(C,10);if(isNaN(R)){throw new Error("Invalid Content-ID value in change set response.");}return R;}function j(H,l){var i,m,n=H.split("\r\n");for(i=0;i<n.length;i++){m=n[i].split(":");if(m[0].toLowerCase().trim()===l){return m[1].trim();}}}function _(C,R,I){var B=R.split(g(C)),l=[];B=B.slice(1,-1);B.forEach(function(m){var n,o,p,H,t,u,v,w,i,M,x={},y,z;z=m.split("\r\n\r\n");M=z[0];n=f(M);if(n){l.push(_(n,z.slice(1).join("\r\n\r\n"),true));return;}v=z[1].split("\r\n");w=v[0].split(" ");x.status=parseInt(w[1],10);x.statusText=w.slice(2).join(' ');x.headers={};for(i=1;i<v.length;i++){H=v[i];p=H.indexOf(':');t=H.slice(0,p).trim();u=H.slice(p+1).trim();x.headers[t]=u;if(t.toLowerCase()==="content-type"){o=d(u,"charset");if(o&&o.toLowerCase()!=="utf-8"){throw new Error('Unsupported "Content-Type" charset: '+o);}}}x.responseText=z[2].slice(0,-2);if(I){y=h(M);l[y]=x;}else{l.push(x);}});return l;}function s(H){var i,l=[];for(i in H){l=l.concat(i,":",H[i],"\r\n");}return l;}function k(R,C){var B=(C!==undefined?"changeset_":"batch_")+q.sap.uid(),i=C!==undefined,l=[];if(i){l=l.concat("Content-Type: multipart/mixed;boundary=",B,"\r\n\r\n");}R.forEach(function(o,m){var n="",u=o.url;if(i){n="Content-ID:"+m+"."+C+"\r\n";}l=l.concat("--",B,"\r\n");if(Array.isArray(o)){if(i){throw new Error('Change set must not contain a nested change set.');}l=l.concat(k(o,m).body);}else{if(i&&!a[o.method]){throw new Error("Invalid HTTP request method: "+o.method+". Change set must contain only POST, PUT, PATCH or DELETE requests.");}u=u.replace(r,"$&."+C);l=l.concat("Content-Type:application/http\r\n","Content-Transfer-Encoding:binary\r\n",n,"\r\n",o.method," ",u," HTTP/1.1\r\n",s(o.headers),"\r\n",JSON.stringify(o.body)||"","\r\n");}});l=l.concat("--",B,"--\r\n");return{body:l,batchBoundary:B};}b={deserializeBatchResponse:function(C,R){return _(C,R,false);},serializeBatchRequest:function(R){var B=k(R);return{body:B.body.join(""),headers:{"Content-Type":"multipart/mixed; boundary="+B.batchBoundary,"MIME-Version":"1.0"}};}};return b;},false);
