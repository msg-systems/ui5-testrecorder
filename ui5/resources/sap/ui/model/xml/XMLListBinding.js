/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/model/ChangeReason','sap/ui/model/ClientListBinding',"sap/ui/util/XMLHelper","sap/base/util/array/diff","sap/base/util/deepEqual","sap/ui/thirdparty/jquery"],function(C,a,X,d,b,q){"use strict";var c=a.extend("sap.ui.model.xml.XMLListBinding");c.prototype.getContexts=function(s,l){this.iLastStartIndex=s;this.iLastLength=l;if(!s){s=0;}if(!l){l=Math.min(this.iLength,this.oModel.iSizeLimit);}var e=this._getContexts(s,l),f=[];if(this.bUseExtendedChangeDetection){for(var i=0;i<e.length;i++){f.push(this.getContextData(e[i]));}if(this.aLastContexts&&s<this.iLastEndIndex){e.diff=d(this.aLastContextData,f);}this.iLastEndIndex=s+l;this.aLastContexts=e.slice(0);this.aLastContextData=f.slice(0);}return e;};c.prototype.getCurrentContexts=function(){if(this.bUseExtendedChangeDetection){return this.aLastContexts||[];}else{return this.getContexts(this.iLastStartIndex,this.iLastLength);}};c.prototype.getEntryData=function(o){return X.serialize(o.getObject());};c.prototype.update=function(){var l=this.oModel._getObject(this.sPath,this.oContext);if(l){this.oList=[];var t=this;if(this.bUseExtendedChangeDetection){q.each(l,function(k,n){t.oList.push(n.cloneNode(true));});}else{this.oList=l.slice(0);}this.updateIndices();this.applyFilter();this.applySort();this.iLength=this._getLength();}else{this.oList=[];this.aIndices=[];this.iLength=0;}};c.prototype.checkUpdate=function(f){if(this.bSuspended&&!this.bIgnoreSuspend&&!f){return;}if(!this.bUseExtendedChangeDetection){var l=this.oModel._getObject(this.sPath,this.oContext)||[];if(l.length!=this.oList.length||f){this.update();this._fireChange({reason:C.Change});}}else{var e=false;var t=this;var l=this.oModel._getObject(this.sPath,this.oContext)||[];if(this.oList.length!=l.length){e=true;}if(!b(this.oList,l)){this.update();}var g=this._getContexts(this.iLastStartIndex,this.iLastLength);if(this.aLastContexts){if(this.aLastContexts.length!=g.length){e=true;}else{q.each(this.aLastContextData,function(i,L){var o=t.getContextData(g[i]);if(o!==L){e=true;return false;}});}}else{e=true;}if(e||f){this._fireChange({reason:C.Change});}}};return c;});
