ace.define("ace/ext/elastic_tabstops_lite",["require","exports","module","ace/editor","ace/config"],function(a,e,m){"use strict";var E=function(c){this.$editor=c;var s=this;var d=[];var r=false;this.onAfterExec=function(){r=false;s.processRows(d);d=[];};this.onExec=function(){r=true;};this.onChange=function(f){if(r){if(d.indexOf(f.start.row)==-1)d.push(f.start.row);if(f.end.row!=f.start.row)d.push(f.end.row);}};};(function(){this.processRows=function(c){this.$inChange=true;var d=[];for(var r=0,f=c.length;r<f;r++){var g=c[r];if(d.indexOf(g)>-1)continue;var h=this.$findCellWidthsForBlock(g);var i=this.$setBlockCellWidthsToMax(h.cellWidths);var j=h.firstRow;for(var w=0,l=i.length;w<l;w++){var k=i[w];d.push(j);this.$adjustRow(j,k);j++;}}this.$inChange=false;};this.$findCellWidthsForBlock=function(r){var c=[],w;var d=r;while(d>=0){w=this.$cellWidthsForRow(d);if(w.length==0)break;c.unshift(w);d--;}var f=d+1;d=r;var n=this.$editor.session.getLength();while(d<n-1){d++;w=this.$cellWidthsForRow(d);if(w.length==0)break;c.push(w);}return{cellWidths:c,firstRow:f};};this.$cellWidthsForRow=function(r){var s=this.$selectionColumnsForRow(r);var t=[-1].concat(this.$tabsForRow(r));var w=t.map(function(j){return 0;}).slice(1);var l=this.$editor.session.getLine(r);for(var i=0,c=t.length-1;i<c;i++){var d=t[i]+1;var f=t[i+1];var g=this.$rightmostSelectionInCell(s,f);var h=l.substring(d,f);w[i]=Math.max(h.replace(/\s+$/g,'').length,g-d);}return w;};this.$selectionColumnsForRow=function(r){var s=[],c=this.$editor.getCursorPosition();if(this.$editor.session.getSelection().isEmpty()){if(r==c.row)s.push(c.column);}return s;};this.$setBlockCellWidthsToMax=function(d){var f=true,g,h,i;var k=this.$izip_longest(d);for(var c=0,l=k.length;c<l;c++){var n=k[c];if(!n.push){console.error(n);continue;}n.push(NaN);for(var r=0,s=n.length;r<s;r++){var w=n[r];if(f){g=r;i=0;f=false;}if(isNaN(w)){h=r;for(var j=g;j<h;j++){d[j][c]=i;}f=true;}i=Math.max(i,w);}}return d;};this.$rightmostSelectionInCell=function(c,d){var r=0;if(c.length){var l=[];for(var s=0,f=c.length;s<f;s++){if(c[s]<=d)l.push(s);else l.push(0);}r=Math.max.apply(Math,l);}return r;};this.$tabsForRow=function(r){var c=[],l=this.$editor.session.getLine(r),d=/\t/g,f;while((f=d.exec(l))!=null){c.push(f.index);}return c;};this.$adjustRow=function(r,c){var d=this.$tabsForRow(r);if(d.length==0)return;var f=0,g=-1;var h=this.$izip(c,d);for(var i=0,l=h.length;i<l;i++){var w=h[i][0],j=h[i][1];g+=1+w;j+=f;var k=g-j;if(k==0)continue;var p=this.$editor.session.getLine(r).substr(0,j);var s=p.replace(/\s*$/g,"");var n=p.length-s.length;if(k>0){this.$editor.session.getDocument().insertInLine({row:r,column:j+1},Array(k+1).join(" ")+"\t");this.$editor.session.getDocument().removeInLine(r,j,j+1);f+=k;}if(k<0&&n>=-k){this.$editor.session.getDocument().removeInLine(r,j+k,j);f+=k;}}};this.$izip_longest=function(c){if(!c[0])return[];var d=c[0].length;var f=c.length;for(var i=1;i<f;i++){var L=c[i].length;if(L>d)d=L;}var g=[];for(var l=0;l<d;l++){var s=[];for(var i=0;i<f;i++){if(c[i][l]==="")s.push(NaN);else s.push(c[i][l]);}g.push(s);}return g;};this.$izip=function(w,t){var s=w.length>=t.length?t.length:w.length;var c=[];for(var i=0;i<s;i++){var d=[w[i],t[i]];c.push(d);}return c;};}).call(E.prototype);e.ElasticTabstopsLite=E;var b=a("../editor").Editor;a("../config").defineOptions(b.prototype,"editor",{useElasticTabstops:{set:function(v){if(v){if(!this.elasticTabstops)this.elasticTabstops=new E(this);this.commands.on("afterExec",this.elasticTabstops.onAfterExec);this.commands.on("exec",this.elasticTabstops.onExec);this.on("change",this.elasticTabstops.onChange);}else if(this.elasticTabstops){this.commands.removeListener("afterExec",this.elasticTabstops.onAfterExec);this.commands.removeListener("exec",this.elasticTabstops.onExec);this.removeListener("change",this.elasticTabstops.onChange);}}}});});(function(){ace.require(["ace/ext/elastic_tabstops_lite"],function(){});})();
