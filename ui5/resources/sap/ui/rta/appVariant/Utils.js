/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/LrepConnector","sap/ui/rta/appVariant/AppVariantUtils","sap/base/i18n/ResourceBundle"],function(L,A,R){"use strict";var U={};var m=sap.ui.require.toUrl("sap/ui/rta/appVariant/manageApps/")+"webapp";var i=R.create({url:m+"/i18n/i18n.properties"});U.sendRequest=function(r,o){var l=L.createConnector();return l.send(r,o);};U.getAppVariantOverviewAttributes=function(a,k){var o;var c=function(){if(a.isOriginal&&a.isAppVariant){return i.getText("MAA_ORIGINAL_TYPE");}else if(a.isAppVariant){return i.getText("MAA_APP_VARIANT_TYPE");}else if(a.isOriginal){return i.getText("MAA_ORIGINAL_TYPE");}};var f=function(N){var b=sap.ushell.Container.getService("CrossApplicationNavigation");return b.getLinks(N);};var g=function(o){if(a.hasStartableIntent){var s=a.startWith.semanticObject;var b=a.startWith.action;var p=a.startWith.parameters;var N={semanticObject:s,action:b,params:p};return f(N).then(function(r){if(r.length&&k){o.adaptUIButtonVisibility=true;}else{o.adaptUIButtonVisibility=false;}o.semanticObject=s;o.action=b;if(p){Object.keys(p).forEach(function(P){if(p[P].value){p[P]=p[P].value;}});o.params=p;}return Promise.resolve(o);});}else{o.adaptUIButtonVisibility=false;return Promise.resolve(o);}};var I=a.iconUrl;if(I&&sap.ui.core.IconPool.isIconURI(I)){a.iconText=I.split('//')[1];}o={appId:a.appId,title:a.title||'',subTitle:a.subTitle||'',description:a.description||'',icon:a.iconUrl||'',iconText:a.iconText,isOriginal:a.isOriginal,typeOfApp:c(),descriptorUrl:a.descriptorUrl,isKeyUser:k};var n=A.getNewAppVariantId();if(n===a.appId){o.currentStatus=i.getText("MAA_NEW_APP_VARIANT");}return g(o);};U.getAppVariantOverview=function(r,k){var l=k?'CUSTOMER*':'VENDOR';var s='/sap/bc/lrep/app_variant_overview/?sap.app/id='+r+'&layer='+l;return this.sendRequest(s,'GET').then(function(o){var a=[];var b;if(o.response&&o.response.items){b=o.response.items;}else{return Promise.resolve([]);}b.forEach(function(c){if(!c.isDescriptorVariant){a.push(this.getAppVariantOverviewAttributes(c,k));}},this);return Promise.all(a).then(function(c){return c;});}.bind(this));};U.getDescriptor=function(d){return this.sendRequest(d,'GET').then(function(r){return r.response;});};return U;},true);
